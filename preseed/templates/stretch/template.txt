#### preseed: Preconfiguration file for ubuntu
# http://d-i.alioth.debian.org/manual/example-preseed.txt
# http://www.debian.org/releases/testing/example-preseed.txt
# https://help.ubuntu.com/12.04/installation-guide/example-preseed.txt
# http://lackof.org/taggart/hacking/d-i_preseed/preseed.cfg

# http://wiki.debian.org/DebianInstaller/Preseed
# https://help.ubuntu.com/12.04/installation-guide/amd64/appendix-preseed.html

# https://www.soljerome.com/blog/2011/06/28/preseeding-ubuntu-10-04/
# http://www.siriad.com/preseed/preseed.cfg

# http://blogs.cae.tntech.edu/mwr/2007/04/17/unattended-debian-installations-or-how-i-learned-to-stop-worrying-and-love-the-preseedcfg/

# Reformat from email text
# sed -i -r 's/d-i  */d-i /; s/  *([sb][teo])/\t\1/' preseed

##############
# Networking
##############

d-i netcfg/choose_interface	select eth0

# default DHCP networking
#d-i netcfg/get_nameservers	string 
#d-i netcfg/get_ipaddress	string 
#d-i netcfg/get_netmask	string 255.255.255.0
#d-i netcfg/get_gateway	string 
#d-i netcfg/confirm_static	boolean true

# Any hostname and domain names assigned from dhcp take precedence over
# values set here. However, setting the values still prevents the questions
# from being shown, even if values come from dhcp.
d-i netcfg/get_hostname	string vhost
d-i netcfg/get_domain	string vdomain
# The wacky dhcp hostname that	some ISPs use as a password of sorts.
d-i netcfg/dhcp_hostname	string vdomain
# Disable that annoying WEP key dialog.
d-i netcfg/wireless_wep	string

#d-i mirror/http/proxy	string


########################
# Installation
########################

# *!*
d-i debian-installer/locale	string en_US
d-i debian-installer/splash	boolean false

# Controls whether to use NTP to set the clock during the install
d-i clock-setup/ntp	boolean true
# NTP server to use. The default is almost always fine here.
#d-i clock-setup/ntp-server	string ntp.example.com

### Finishing
# Avoid that last message about the install being complete.
d-i finish-install/reboot_in_progress note
# weather to prevent the installer from ejecting the CD during the reboot
d-i cdrom-detect/eject	boolean true
# weather to make the installer shutdown when finished, not
#  to reboot into the installed system.
d-i debian-installer/exit/halt	boolean false
# weather to power off the machine instead of just halting it.
d-i debian-installer/exit/poweroff	boolean false

### Mirror settings
# *!*
#d-i mirror/country	string US
#d-i mirror/http/mirror	string us.archive.ubuntu.com
#d-i mirror/http/directory	string /ubuntu/

### Apt setup
d-i apt-setup/backports	boolean true
d-i apt-setup/contrib	boolean true
d-i apt-setup/multiverse	boolean true
d-i apt-setup/non-free	boolean true
d-i apt-setup/proposed	boolean true
d-i apt-setup/universe	boolean true
# Enable deb-src lines
d-i apt-setup/universe/source boolean true

# Select which update services to use
#d-i apt-setup/services-select    multiselect	security
#d-i apt-setup/security_host	string	security.ubuntu.com
#d-i apt-setup/security_path	string /ubuntu

# Configure APT to not install recommended packages by default.
#d-i base-installer/install-recommends boolean false
# don't try and do automatic updates; that's bcfg2's job
#d-i pkgsel/update-policy	select none

# Force debconf priority to critical.
debconf debconf/priority select critical
# Override default frontend to readline, 
debconf debconf/frontend select readline
# but allow user to select.
#debconf debconf/frontend seen false

#################################
# Disk Partitioning/Boot loader
#################################

#d-i partman-auto/purge_lvm_from_device	boolean true

# Using the default partitioning scheme and wiping any existing partitions. 

#d-i partman-auto/disk	string /dev/sda
#d-i partman-auto/method	string regular
# - regular: use the usual partition types for your architecture
# - lvm:     use LVM to partition the disk
# - crypto:  use LVM within an encrypted partition
#d-i partman-auto/choose_recipe select atomic
# - atomic: all files in one partition
# - home:   separate /home partition
# - multi:  separate /home, /usr, /var, and /tmp partitions
#d-i partman/default_filesystem	string ext3

# This makes partman automatically partition without confirmation.
#d-i partman/choose_partition	select finish
#d-i partman/confirm_write_new_label	boolean true
#d-i partman/confirm_nooverwrite	boolean true
#d-i partman/confirm	boolean true

## how partitions are mounted
# The default is to mount by UUID, but you can also choose "traditional" to
# use traditional device names, or "label" to try filesystem labels before
# falling back to UUIDs.
d-i partman/mount_style select	traditional

### Booting

# To skip installing lilo
#d-i lilo-installer/skip	boolean	true
#d-i grub-installer/skip	boolean false

# To use GRUB Legacy instead of default GRUB 2
#d-i grub-installer/grub2_instead_of_grub_legacy boolean false
# Optional password for grub, in clear text
#d-i grub-installer/password password r00tme

# Use the following option to add additional boot parameters for the
# installed system (if supported by the bootloader installer).
# Note: options passed to the installer will be added automatically.
#d-i debian-installer/add-kernel-opts string 

# This is fairly safe to set, it makes grub install automatically to the MBR
# if no other operating system is detected on the machine.
#d-i grub-installer/only_debian boolean true
# This one makes grub-installer install to the MBR if it also finds some other
# OS, which is less safe as it might not be able to boot that other OS.
#d-i grub-installer/with_other_os boolean true

# Alternatively, if you want to install to a location other than the mbr,
# use these lines:
#d-i grub-installer/only_debian boolean false
#d-i grub-installer/with_other_os boolean false
#d-i grub-installer/bootdev  string (hd0,0)

#d-i grub-pc/install_devices multiselect /dev/sda


#################
# Localizations
#################

# Keyboard localization
d-i console-setup/ask_detect	boolean false
d-i console-setup/layoutcode	string us
d-i console-keymaps-at/keymap	select us
d-i console-setup/variantcode	string 
#d-i console-setup/variantcode	string dvorak

# Timezone
d-i clock-setup/utc	boolean true
# *!*
d-i time/zone	string	America/Toronto


#################
# User Creation
#################

d-i user-setup/allow-password-weak	boolean true
d-i user-setup/password-weak	boolean true

d-i user-setup/encrypt-home	boolean false

# -- create a root user (with login capabilities) having the password r00tme.
#d-i passwd/root-login	boolean true
#d-i passwd/make-user	boolean false
#d-i passwd/root-password password r00tme
#d-i passwd/root-password-again password r00tme

d-i passwd/root-login	boolean false
d-i passwd/make-user	boolean true
# *!*
d-i passwd/user-fullname	string	user
d-i passwd/username	string    user
d-i passwd/user-password    password	user
d-i passwd/user-password-again password user
d-i passwd/user-uid	string    1001
d-i passwd/user-default-groups	string	adm tty disk lp mail news uucp man dialout fax voice cdrom floppy tape sudo audio dip www-data backup operator list irc src gnats shadow video sasl plugdev staff games users nogroup crontab syslog fuse messagebus mlocate ssh lpadmin sambashare vboxsf
# cat /etc/group | awk -F':' '{print $1}' | xargs 

#######################
# Software Selections
#######################

### Base system installation

### Package selection
# see https://help.ubuntu.com/community/Tasksel
tasksel tasksel/first multiselect standard, web-server
# Leave empty for minimum installation
#tasksel tasksel/first multiselect

# Individual additional packages to install 
# a minimum X by fluxbox that start by 'startx', with notepad, file browser and ACPI support
# with xwininfo (x11-utils) & lndir (xutils-dev)
d-i pkgsel/include	string	 gpm acpi-support cryptsetup openssh-server localepurge tmpreaper build-essential rsync curl less jed wdiff athena-jot xterm x11-utils xutils-dev xclip leafpad meld xserver-xorg xserver-xorg-video-vesa xinit fluxbox

# Whether to upgrade packages after debootstrap.
# Allowed values: none, safe-upgrade, full-upgrade
d-i pkgsel/upgrade select none


#######################
# X configuration
#######################
# Monitor autodetection is recommended.
xserver-xorg xserver-xorg/autodetect_monitor boolean true
# weather you have an LCD display.
xserver-xorg xserver-xorg/config/monitor/lcd boolean true
# X has three configuration paths for the monitor. Here's how to preseed
# the "medium" path, which is always available. The "simple" path may not
# be available, and the "advanced" path asks too many questions.
xserver-xorg xserver-xorg/config/monitor/selection-method \
       select medium
xserver-xorg xserver-xorg/config/monitor/mode-list \
       select 1024x768 @ 60 Hz


#######################
# Packages Preseeding 
#######################
# Depending on what software you choose to install, or if things go wrong
# during the installation process, it's possible that other questions may
# be asked. You can preseed those too, of course. To get a list of every
# possible question that could be asked during an install, do an
# installation, and then run these commands:
#   debconf-get-selections --installer > file
#   debconf-get-selections >> file

# == Packages Preseeding Begin

### Pkg:localepurge
#
localepurge     localepurge/nopurge     multiselect     en_US
# Really remove all locales?
localepurge     localepurge/none_selected       boolean false
# Also delete localized man pages?
localepurge     localepurge/mandelete   boolean true
# localepurge will not take any action
localepurge     localepurge/remove_no   note
# Inform about new locales?
localepurge     localepurge/dontbothernew       boolean false
# Display verbose output?
localepurge     localepurge/verbose     boolean false
# Display freed disk space?
localepurge     localepurge/showfreedspace      boolean true
# Accurate disk space calculation?
localepurge     localepurge/quickndirtycalc     boolean true

### Pkg:tmpreaper
#
# default value for TMPREAPER_TIME now set via /etc/default/rcS
tmpreaper       tmpreaper/TMPREAPER_TIME        note
# tmpreaper can now be adjusted through /etc/tmpreaper.conf
tmpreaper       tmpreaper/confignowexists       note
# Please first read README.security
tmpreaper       tmpreaper/readsecurity  note
# Please first read README.security
tmpreaper       tmpreaper/readsecurity_upgrading        note

# == Packages Preseeding End


#######################
# Advanced options
#######################
# https://help.ubuntu.com/12.04/installation-guide/i386/preseed-advanced.html


### Running custom commands during the installation
# http://ubuntuforums.org/showthread.php?t=1977570
# http://ubuntuforums.org/showthread.php?t=1314680

# This first command is run as early as possible, just after
# preseeding is read.
#d-i preseed/early_command string anna-install some-udeb

# This command is run immediately before the partitioner starts. It may be
# useful to apply dynamic partitioner preseeding that depends on the state
# of the disks (which may not be visible when preseed/early_command runs).
#d-i partman/early_command \
#       string debconf-set partman-auto/disk "$(list-devices disk | head -n1)"

# This command is run just before the install finishes, but when there is
# still a usable /target directory. You can chroot to /target and use it
# directly, or use the apt-install and in-target commands to easily install
# packages and run commands in the target system.

d-i preseed/late_command	string \
    in-target apt-get install net-tools
    in-target wget http://{{ request.get_host }}/scripts/{{ instance.instance_id }} -O /root/postinst.sh; \
    in-target /bin/bash /root/postinst.sh

